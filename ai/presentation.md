# 聊聊机器学习

Now the internet age is over, welcome to the age of AI and blockchain.

## 内容

### 不聊什么

 - 编码
 - 公式
 - 推导
 - 前景
 - 方向
 - ...

### 聊什么

 - 数据抽象方法
 - 数据模型选择
 - 数据筛选预处理
 - 建模
 - 验证模型

 看看我们目的是什么， 通过推断用户投资能力

## 数据抽象方法

 - 检查数据项

   - 年龄
   - 省份
   - 银行
   - 性别
   - 初次绑卡时间
   - 邀请人数量
   - 是否投资活期
   - 是否投资定期
   - 活期投资金额
   - 定期投资金额

|年龄|省份|银行|性别|邀请人数|投资活期|投资定期|活期投资金额|定期投资金额|
---|---|---|---|---|---|---|---|---
19| 福建| 中国农业银行| 男| 2017-09-29 11:59:48| 0| 0| 0| 0.000000| 0.000000
39| 黑龙江| 中国工商银行| 男| 2016-04-07 22:51:27| 0| 1| 0| 100.000000| 0.000000
|- | 江苏| | 未知| | 0| 0| 0| 0.000000| 0.000000
30| 山东| 中国农业银行| 女| 2016-04-08 16:20:53| 4| 0| 0| 0.000000| 0.000000
|- | 广东| | 未知| | 0| 0| 0| 0.000000| 0.000000
26| 陕西| | 女| | 0| 0| 0| 0.000000| 0.000000
30| 河北| 中国银行| 男| 2015-05-24 17:31:22| 4| 1| 0| 100.000000| 0.000000
|- | 湖南| | 未知| | 0| 0| 0| 0.000000| 0.000000
|- | 广东| | 未知| | 0| 0| 0| 0.000000| 0.000000
|- | 重庆| | 未知| | 0| 0| 0| 0.000000| 0.000000
|- | 广东| | 未知| | 0| 0| 0| 0.000000| 0.000000
41| 湖南| 中国工商银行| 女| 2016-04-08 16:18:51| 0| 0| 0| 0.000000| 0.000000
24| 云南| 中国工商银行| 男| 2017-05-05 12:18:03| 0| 0| 0| 0.000000| 0.000000
32| 北京| 中国工商银行| 男| 2016-11-15 13:45:21| 0| 1| 0| 50150.000000| 0.000000
|- | 辽宁| | 未知| | 0| 0| 0| 0.000000| 0.000000
|- | 广东| | 未知| | 0| 0| 0| 0.000000| 0.000000
|- | 吉林| | | | 0| 0| 0| 0.000000| 0.000000
|- | 浙江| | 未知| | 0| 0| 0| 0.000000| 0.000000
|- | 广东| | 未知| | 0| 0| 0| 0.000000| 0.000000
|- | 黑龙江| | 未知| | 0| 0| 0| 0.000000| 0.000000
|- | 北京| | 未知| | 0| 0| 0| 0.000000| 0.000000
|- | 广东| | 未知| | 0| 0| 0| 0.000000| 0.000000
|- | 广东| | 未知| | 0| 0| 0| 0.000000| 0.000000
27| 广东| 中国建设银行| 男| 2016-04-07 22:30:11| 0| 1| 0| 100.000000| 0.000000
32| 河北| 中国农业银行| 女| 2015-05-01 21:55:17| 0| 0| 0| 0.000000| 0.000000
... | ...| ...| ...| ...| ...| ...|...|...|...|...|...|

 - 数据抽象方法
   - 标准化，标准差为1的正态分布数据
   - 归一化, 把数据投射到0-1区间
   - 中心化, 按照均值把数据减去均值

 Q: 为什么？

## 数据模型选择

 - 线性回归
 - KNN
 - SVM
 - 随机森林
 - 神经网络
 - 贝叶斯
 - ...

## 数据筛选预处理

 - 划分判定好的数据(训练)
    - 已投资
    - 未投资
      - 已绑卡
      - 未绑卡

 Q: 如何选择训练的数据

   - 已投资用户
   - 5000元以上

 Q: 对哪些用户做判断

   - 已投资但是投资金额<5000
   - 已绑卡未投资

  - 数据处理

|年龄|省份|银行|性别|邀请人数|投资活期|投资定期|活期投资金额|定期投资金额|
---|---|---|---|---|---|---|---|---
1.0000| 0.2500| 0.8000| 0.5000| 0| 0| 1| 1| 0.5000| 0.5000
1.0000| 0.5000| 1.0000| 0.5000| 0.5000| 0| 1| 1| 1.0000| 0.7500
1.0000| 1.0000| 1.0000| 0.5000| 0| 0| 0| 1| 0| 1.0000
1.0000| 0.2500| 1.0000| 0| 0.5000| 0| 1| 1| 1.0000| 0.2500
1.0000| 1.0000| 0.8000| 0.5000| 0| 0| 0| 1| 0| 1.0000
1.0000| 0.2500| 1.0000| 0.5000| 0| 0| 1| 1| 0.5000| 1.0000
1.0000| 1.0000| 0.8000| 0| 0| 0| 1| 1| 1.0000| 1.0000
1.0000| 1.0000| 0.8000| 0.5000| 0| 0| 0| 1| 0| 0.7500
1.0000| 0.7500| 0.2000| 0.5000| 0| 0| 1| 1| 0.7500| 0.2500
1.0000| 0.2500| 0.2000| 0| 0| 0| 0| 1| 0| 1.0000
1.0000| 0.2500| 0.2000| 0.5000| 0| 0| 0| 1| 0| 0.7500
1.0000| 1.0000| 1.0000| 0| 0| 0| 0| 1| 0| 1.0000
1.0000| 1.0000| 0.4000| 0.5000| 0.5000| 0| 0| 1| 0| 0.5000
1.0000| 0.2500| 1.0000| 0| 0| 0| 1| 1| 1.0000| 1.0000
... | ...| ...| ...| ...| ...| ...|...|...|...|...|...|

```sql
select case mu.age
	 when age<18 then 1/6
     when age<25 then 2/6
     when age<35 then 3/6
     when age<45 then 4/6
     when age<55 then 5/6
     else 6/6
	 end age,
     case mu.province
     when '北京' then 1/4
     when '上海' then 2/4
     when '广东' then 3/4
     else 4/4
      end province,
     case mu.bankname
     when '中国工商银行' then 1/5
     when '中国农业银行' then 2/5
     when '中国银行' then 3/5
     when '中国建设银行' then 4/5
     else 5/5
     end bank,
     if(sex='男', 0, if(sex='女', 1/2, 2/2)) sex,
     if(bankcardtime<'2017-01-01', 0, if(bankcardtime<'2018-01-01', 1/2, 2/2)),
     if(invite_cnt=0, 0, if(invite_cnt<3, 1/3, if(invite_cnt<5, 2/3, 3/3))),
	if(cd.SXQTZJE>0,1,0),
    if(cd.DQTZJE>0,1,0),
    if(cd.SXQTZJE<5000, 0, if(cd.SXQTZJE<10000, 1/4, if(cd.SXQTZJE<50000, 2/4, if(cd.SXQTZJE<100000, 3/4, 4/4)))),
	if(cd.DQTZJE<5000, 0, if(cd.DQTZJE<10000, 1/4, if(cd.DQTZJE<50000, 2/4, if(cd.DQTZJE<100000, 3/4, 4/4))))
from m_userinfo mu
left join cus_detail cd on mu.userid = cd.userid
where cd.DQTZJE>5000 and cd.SXQTZJE>5000
```

|年龄|省份|银行|性别|邀请人数|投资活期|投资定期|活期投资金额|定期投资金额|
---|---|---|---|---|---|---|---|---
1.0000| 0.7500| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 0.7500| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 1.0000| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 1.0000| 0.4000| 0.5000| 0| 0| ?| ?| ?| ?
1.0000| 0.7500| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 1.0000| 1.0000| 1.0000| 1.0000| 0.3333| ?| ?| ?| ?
1.0000| 0.7500| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 0.7500| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 1.0000| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 1.0000| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 0.5000| 0.2000| 0| 0| 1.0000| ?| ?| ?| ?
1.0000| 0.7500| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 0.7500| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 1.0000| 0.8000| 0.5000| 0| 0| ?| ?| ?| ?
1.0000| 1.0000| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 1.0000| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 1.0000| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 1.0000| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 0.7500| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 1.0000| 1.0000| 1.0000| 0| 0| ?| ?| ?| ?
1.0000| 1.0000| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 1.0000| 1.0000| 0| 1.0000| 0| ?| ?| ?| ?
1.0000| 1.0000| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 1.0000| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 1.0000| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 0.7500| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 1.0000| 1.0000| 0.5000| 0| 0.3333| ?| ?| ?| ?
1.0000| 1.0000| 0.8000| 0| 0| 0| ?| ?| ?| ?
1.0000| 1.0000| 0.2000| 0| 0| 0| ?| ?| ?| ?
1.0000| 1.0000| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 0.7500| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?
1.0000| 0.7500| 1.0000| 1.0000| 1.0000| 0| ?| ?| ?| ?

```sql
select case mu.age
	 when age<18 then 1/6
     when age<25 then 2/6
     when age<35 then 3/6
     when age<45 then 4/6
     when age<55 then 5/6
     else 6/6
	 end age, 
     case mu.province
     when '北京' then 1/4
     when '上海' then 2/4
     when '广东' then 3/4
     else 4/4
      end province, 
     case mu.bankname
     when '中国工商银行' then 1/5
     when '中国农业银行' then 2/5
     when '中国银行' then 3/5
     when '中国建设银行' then 4/5
     else 5/5 
     end bank, 
     if(sex='男', 0, if(sex='女', 1/2, 2/2)) sex, 
     if(bankcardtime<'2017-01-01', 0, if(bankcardtime<'2018-01-01', 1/2, 2/2)), 
     if(invite_cnt=0, 0, if(invite_cnt<3, 1/3, if(invite_cnt<5, 2/3, 3/3))), 
	'?', 
    '?',
    '?', 
	'?'
from m_userinfo mu
left join cus_detail cd on mu.userid = cd.userid
where cd.DQTZJE<5000 and cd.SXQTZJE<5000
```


### 建模

 - 年龄和活期投资金额关系
 - 银行和活期投资金额关系
 - 性别和活期投资金额关系
 - ...


 选择数据项

   - 年龄
   - 省份
   - 银行
   - 性别
   - 邀请人数量
   - 活期投资金额
   - 定期投资金额

```python
rfr = RandomForestRegressor(random_state=0, n_estimators=2000, n_jobs=-1)
rfr.fit(trains.iloc[:,1:], trains.iloc[:,0])
rfr.predict(tests)
```

### 验证模型

 Q: 如何来验证模型是否正确?

### 查看结果

|年龄|省份|银行|性别|邀请人数|活期投资金额|定期投资金额|
---|---|---|---|---|---|---
1.0000|1.0000|1.0000|1.0000|0.3333|0.72174303|0.31327886
1.0000|0.5000|0.2000|0|1.0000     |0.68858333|0.22395833
1.0000|1.0000|1.0000|0.5000|0.3333|0.72174303|0.31327886
1.0000|1.0000|0.8000|0.5000|1.0000|0.98857143|0.64932143
1.0000|1.0000|1.0000|1.0000|0     |0.43685502|0.52837657
1.0000|1.0000|1.0000|1.0000|0     |0.43685502|0.52837657
1.0000|1.0000|0.8000|0.5000|0     |0.47296555|0.43655985
1.0000|0.7500|1.0000|1.0000|0     |0.6163373 |0.24525198
1.0000|0.7500|1.0000|1.0000|0     |0.6163373 |0.24525198
1.0000|0.2500|0.2000|0.5000|0     |0.5823622 |0.47420068
1.0000|1.0000|1.0000|1.0000|0     |0.43685502|0.52837657
1.0000|1.0000|1.0000|1.0000|0     |0.43685502|0.52837657
1.0000|1.0000|1.0000|1.0000|0     |0.43685502|0.52837657
1.0000|1.0000|1.0000|1.0000|0     |0.43685502|0.52837657
1.0000|1.0000|0.8000|0.5000|0     |0.47296555|0.43655985
1.0000|0.2500|1.0000|1.0000|0     |0.81537389|0.18671272
1.0000|1.0000|0.4000|0.5000|0     |0.54284055|0.15185999
1.0000|1.0000|1.0000|1.0000|0     |0.43685502|0.52837657
1.0000|0.7500|1.0000|1.0000|0     |0.6163373 |0.24525198
1.0000|1.0000|1.0000|1.0000|0     |0.43685502|0.52837657
1.0000|1.0000|1.0000|1.0000|0     |0.43685502|0.52837657
1.0000|0.7500|1.0000|1.0000|0     |0.6163373 |0.24525198
1.0000|0.2500|1.0000|1.0000|0     |0.81537389|0.18671272
1.0000|0.7500|1.0000|1.0000|0     |0.6163373 |0.24525198
1.0000|1.0000|1.0000|1.0000|0     |0.43685502|0.52837657
1.0000|0.7500|1.0000|1.0000|0     |0.6163373 |0.24525198
1.0000|1.0000|1.0000|1.0000|0     |0.43685502|0.52837657
1.0000|0.7500|1.0000|0.5000|0     |0.58919444|0.26110913
1.0000|0.7500|1.0000|0.5000|0     |0.58919444|0.26110913
1.0000|1.0000|1.0000|1.0000|0     |0.43685502|0.52837657

Q: 看到这个结果要干嘛?

撸起袖子加油干，一张蓝图绘到底!

## 总结

 - 数据获取
 - 数据分类
 - 数据抽象
 - 分析数据关联
 - 选择模型
 - 得到结果
 - 验证结果

## 参考资料

  - kaggle.com
  - https://zhuanlan.zhihu.com/p/27577246
  - http://blog.csdn.net/yaoqiang2011/article/list/1
